@* SavedLocations.razor - Dropdown for saved locations *@
@using SnowDayPredictor.Models

@if (locations != null && locations.Any())
{
    <div class="saved-locations mb-3">
        <label for="savedLocationSelect" class="form-label">📌 Saved Locations</label>
        <div class="saved-location-group">
            <select id="savedLocationSelect"
                    class="form-select"
                    value="@CurrentZipCode"
                    @onchange="OnSelectionChanged">
                <option value="">-- Select a saved location --</option>
                @foreach (var location in locations)
                {
                    <option value="@location.ZipCode">
                        @location.CityName (@location.ZipCode)
                    </option>
                }
            </select>
            @if (!string.IsNullOrEmpty(CurrentZipCode) && locations.Any(l => l.ZipCode == CurrentZipCode))
            {
                <button class="btn btn-outline-danger btn-sm delete-btn"
                        @onclick="DeleteCurrentLocation"
                        title="Delete this saved location">
                    🗑️
                </button>
            }
        </div>
    </div>
}

@code {
    [Parameter]
    public List<SavedLocation> locations { get; set; } = new();

    [Parameter]
    public EventCallback<string> OnLocationSelected { get; set; }

    [Parameter]
    public EventCallback<string> OnLocationDeleted { get; set; }

    [Parameter]
    public string? CurrentZipCode { get; set; }

    private async Task OnSelectionChanged(ChangeEventArgs e)
    {
        var selectedZip = e.Value?.ToString() ?? "";
        if (!string.IsNullOrEmpty(selectedZip))
        {
            await OnLocationSelected.InvokeAsync(selectedZip);
        }
    }

    private async Task DeleteCurrentLocation()
    {
        if (!string.IsNullOrEmpty(CurrentZipCode))
        {
            await OnLocationDeleted.InvokeAsync(CurrentZipCode);
        }
    }
}

<style>
    .saved-locations {
        max-width: 100%;
    }

    .saved-location-group {
        display: flex;
        gap: 0.5rem;
        align-items: stretch;
    }

        .saved-location-group .form-select {
            flex: 1;
        }

    .delete-btn {
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        line-height: 1.5;
    }

    .form-label {
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
</style>
